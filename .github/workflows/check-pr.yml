name: Check PR

on: pull_request

jobs:
  build:
    name: Build
    uses: alphagov/di-onboarding-product-page/.github/workflows/build.yml@f750c28d35c2dce51c78ad36b6e112e8cf0ec62b

  run-unit-tests:
    name: Run tests
    uses: alphagov/di-onboarding-product-page/.github/workflows/run-unit-tests.yml@f750c28d35c2dce51c78ad36b6e112e8cf0ec62b

  deploy-preview:
    name: Preview
    needs: build
    uses: alphagov/di-onboarding-product-page/.github/workflows/deploy-to-paas.yml@f750c28d35c2dce51c78ad36b6e112e8cf0ec62b
    with:
      environment: preview
      app_name: di-product-page-preview-${{ github.head_ref }}
      url: https://di-product-page-preview-${{ github.head_ref }}.london.cloudapps.digital
      use_stub_zendesk: true
    secrets:
      CF_USERNAME: ${{ secrets.CF_USERNAME }}
      CF_PASSWORD: ${{ secrets.CF_PASSWORD }}
      REGISTER_SPREADSHEET_ID: ${{ secrets.REGISTER_SPREADSHEET_ID }}
      REQUEST_SPREADSHEET_ID: ${{ secrets.REQUEST_SPREADSHEET_ID }}

  run-acceptance-tests:
    name: Run tests
    needs: deploy-preview
    uses: alphagov/di-onboarding-product-page/.github/workflows/run-acceptance-tests.yml@f750c28d35c2dce51c78ad36b6e112e8cf0ec62b
